<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width initial-scale=1">
  <title>Cadastro de Corretores - Edifício Portugal</title>
   <!-- Estilo externo -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="topo"></div>
  <div class="container">
    <!-- Cabeçalho -->
    <div class="header">
      <div class="brand">
        <img src="images/logo-22-ot.jpg" alt="Edifício Portugal">
      </div>
      <div class="title">
        <h1>Cadastro de Corretores</h1>
        <p>Edifício Portugal – Liberação de Visitas</p>
      </div>
    </div>

    <!-- Texto informativo -->
    <div class="info-text">
      <p><strong>Preencha seus dados e os dos corretores autorizados.</strong></p>
      <p><strong>As visitas estão permitidas de segunda a sexta ou sábado, das <strong>08:00 às 18:00</strong>.</strong></p>
    </div>

    <!-- Formulário -->
    <main>
      <section class="card">
        <form id="corretoresForm">
          <!-- Dados do Proprietário -->
          <div class="section">
            <h2>Dados do Proprietário</h2>
            <label>Nome completo</label>
            <input type="text" name="nome_proprietario" required />
            <div class="row">
              <div>
                <label>Nº do apartamento</label>
                <select name="apartamento" required>
                  <option value="">Selecione o apartamento</option>
                  <option value="01">01</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="31">31</option>
                  <option value="32">32</option>
                  <option value="33">33</option>
                  <option value="34">34</option>
                  <option value="41">41</option>
                  <option value="42">42</option>
                  <option value="43">43</option>
                  <option value="44">44</option>
                  <option value="51">51</option>
                  <option value="52">52</option>
                  <option value="53">53</option>
                  <option value="54">54</option>
                  <option value="61">61</option>
                  <option value="62">62</option>
                  <option value="63">63</option>
                  <option value="64">64</option>
                  <option value="71">71</option>
                  <option value="72">72</option>
                  <option value="73">73</option>
                  <option value="74">74</option>
                  <option value="81">81</option>
                  <option value="82">82</option>
                  <option value="83">83</option>
                  <option value="84">84</option>
                  <option value="91">91</option>
                  <option value="92">92</option>
                  <option value="93">93</option>
                  <option value="94">94</option>
                  <option value="101">101</option>
                  <option value="102">102</option>
                  <option value="103">103</option>
                  <option value="104">104</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Corretores Autorizados -->
          <div class="section">
            <h2>Corretores Autorizados</h2>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Informe os corretores que podem agendar visitas ao imóvel.</p>
            <div id="corretores-list" class="dynamic-list"></div>
            <button type="button" onclick="addCorretor()">+ Adicionar Corretor</button>
          </div>

          <!-- Botão de envio -->
          <button type="submit" class="btn-submit">Enviar por E-mail</button>
        </form>

        <!-- Mensagem de resultado -->
        <div id="mensagem"></div>
      </section>
    </main>
  </div>

  <script>
    // Contador de corretores
    let corretorCount = 0;

    // Adicionar Corretor
    function addCorretor() {
      const container = document.getElementById('corretores-list');
      const div = document.createElement('div');
      div.className = 'dynamic-item';
      div.innerHTML = `
        <button type="button" class="remove" onclick="this.parentElement.remove()">X</button>
        <div>
          <label>Nome completo</label>
          <input type="text" name="corretor_nome_${corretorCount}" required />
        </div>
        <div class="row">
          <div>
            <label>CRECI</label>
            <input type="text" name="corretor_creci_${corretorCount}" placeholder="SP-12345" required />
          </div>
          <div>
            <label>Dias de visita permitidos</label>
            <select name="corretor_dias_${corretorCount}" required>
              <option value="">Selecione</option>
              <option value="Segunda a Sexta">Segunda a Sexta</option>
              <option value="Segunda a Sábado">Segunda a Sábado</option>
            </select>
          </div>
        </div>
      `;
      container.appendChild(div);
      corretorCount++;
    }

    // Adicionar primeiro corretor automaticamente
    document.addEventListener('DOMContentLoaded', function() {
      addCorretor();
    });

    // Enviar formulário
    const formEl = document.getElementById('corretoresForm');
    const mensagemEl = document.getElementById('mensagem');

    formEl.addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = {};
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }

      // Validar dados do proprietário
      if (!data.nome_proprietario || !data.apartamento) {
        mensagemEl.innerHTML = '⚠️ Por favor, preencha todos os dados do proprietário.';
        mensagemEl.className = 'error';
        mensagemEl.style.display = 'block';
        return;
      }

      // Coletar corretores
      const corretores = [];
      for (let i = 0; i < corretorCount; i++) {
        const nome = data[`corretor_nome_${i}`];
        const creci = data[`corretor_creci_${i}`];
        const dias = data[`corretor_dias_${i}`];
        if (nome && creci && dias) {
          corretores.push({ nome, creci, dias });
        }
      }

      if (corretores.length === 0) {
        mensagemEl.innerHTML = '⚠️ Adicione pelo menos um corretor.';
        mensagemEl.className = 'error';
        mensagemEl.style.display = 'block';
        return;
      }

      // Gerar e-mail em HTML
      const assunto = encodeURIComponent(`Autorização de Corretores - Apartamento ${data.apartamento}`);
      const corpoHTML = `
        <html>
        <body style="font-family: Arial, sans-serif; color: #333; line-height: 1.6;">
          <div style="max-width: 600px; margin: auto; border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">
            <div style="background: linear-gradient(90deg, #1a3b5d, #2c5c8a); color: white; padding: 20px; text-align: center;">
              <h2 style="margin: 0;">Autorização de Corretores</h2>
              <p style="margin: 5px 0 0; opacity: 0.9;">Edifício Portugal</p>
            </div>
            <div style="padding: 20px;">
              <p><strong>Proprietário:</strong> ${data.nome_proprietario}</p>
              <p><strong>Apartamento:</strong> ${data.apartamento}</p>
              <p><strong>Horário permitido:</strong> 08:00 às 18:00</p>
              <h3 style="color: #1a3b5d; border-bottom: 1px solid #eee; padding-bottom: 5px;">Corretores Autorizados</h3>
              <table width="100%" style="border-collapse: collapse; margin: 15px 0;">
                <tr style="background-color: #f0f4f8; font-weight: bold;">
                  <td style="padding: 8px; border: 1px solid #ddd;">Nome</td>
                  <td style="padding: 8px; border: 1px solid #ddd;">CRECI</td>
                  <td style="padding: 8px; border: 1px solid #ddd;">Dias Permitidos</td>
                </tr>
                ${corretores.map(c => `
                <tr>
                  <td style="padding: 8px; border: 1px solid #ddd;">${c.nome}</td>
                  <td style="padding: 8px; border: 1px solid #ddd;">${c.creci}</td>
                  <td style="padding: 8px; border: 1px solid #ddd;">${c.dias}</td>
                </tr>
                `).join('')}
              </table>
              <p><em>Este cadastro autoriza os corretores listados a agendar visitas ao imóvel dentro do horário permitido.</em></p>
            </div>
            <div style="background: #f9f9fb; padding: 15px; text-align: center; font-size: 0.9em; color: #666; border-top: 1px solid #eee;">
              Edifício Portugal &copy; ${new Date().getFullYear()}
            </div>
          </div>
        </body>
        </html>
      `.replace(/\s+/g, ' ').trim();

      const corpoTexto = `
        AUTORIZAÇÃO DE CORRETORES - Edifício Portugal

        Proprietário: ${data.nome_proprietario}
        Apartamento: ${data.apartamento}
        Horário permitido: 08:00 às 18:00

        Corretores Autorizados:
        ${corretores.map(c => `- ${c.nome} (CRECI: ${c.creci}) - ${c.dias}`).join('\n')}

        Este cadastro autoriza os corretores listados a agendar visitas ao imóvel dentro do horário permitido.

        Edifício Portugal © ${new Date().getFullYear()}
      `.trim();


        // Apenas texto simples no mailto (HTML não é suportado)
        const mailtoString = `mailto:edportugal85@gmail.com?subject=${assunto}&body=${encodeURIComponent(corpoTexto)}`;

        // Abrir em nova janela para evitar bloqueio
        window.open(mailtoString, '_blank');

        // Mensagem de sucesso
        mensagemEl.innerHTML = `✅ E-mail aberto com sucesso!<br>Confirme o envio no seu cliente de e-mail.`;
        mensagemEl.className = 'success';
        mensagemEl.style.display = 'block';


      // Abrir e-mail
      window.location.href = mailtoLink;

      // Mensagem de sucesso
      mensagemEl.innerHTML = `✅ E-mail aberto com sucesso!<br>Confirme o envio no seu cliente de e-mail.`;
      mensagemEl.className = 'success';
      mensagemEl.style.display = 'block';
    });
  </script>
</body>
</html>